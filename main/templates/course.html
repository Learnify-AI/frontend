{% extends 'base.html' %}
{% block title %} Courses {% endblock %}
{% block text %}Upload{%endblock%}
{% block content%}
{% if courses %}
<h3>Courses</h3>
<div class="row">
  {% for course in courses %}
    <div class="col-md-12 col-sm-12 col-lg-6 col-xl-6">
      <div class="dash-widget">
        <span class="dash-widget-bg"><i class="fa fa-stethoscope" aria-hidden="true"></i></span>
        <div class="dash-widget-info text-right">
          <h3>{{course.course_name}}</h3>
          <span class="widget-title1">{{course.no_of_topics}} topics</i></span><br>
          <span class="widget-title2">20 practice questions</i></span>
        </div>
        <button class="start-quiz button-upload" data-toggle="modal" data-target="#setpractice" data-courseid="{{course.id}}" >Start Practice</button>
      </div>
    </div>
  {% endfor %}
</div>
{% endif %}
<div class="modal fade" id="setpractice" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Set Up Your Study Mode</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="practiceForm">
          <div class="form-group">
            <label for="studymode" class="col-form-label">Select Mode</label>
            <select class="form-select" id="mode" aria-label="mode">
              <option value="practice">Practice Mode</option>
              <option value="exam">Exam Mode</option>
            </select>
          </div>
          <div class="form-group">
            <label for="topics" class="col-form-label">Topics</label>
            <select multiple class="form-select" aria-label="topics" id="topics">
              <option value="exam-1">topic 1</option>
              <option value="exam-2">topic 2</option>
              <option value="exam-3">topic 3</option>
            </select>
          </div>
          <div class="form-group" id="minutesGroup">
            <label for="minutes" class="col-form-label">Minutes:</label>
            <input type="number" name="minutes" value="0" class="form-control" id="minutes" placeholder="minutes">
          </div>
          <div class="form-group" id="hoursGroup">
            <label for="hours" class="col-form-label">Hours:</label>
            <input type="number" name="hours" value="0" class="form-control" id="hours" placeholder="hours">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary" id="button-pin">Start Practice</button>
          </div>
        </form>        
      </div>
    </div>
  </div>
</div> 
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Course Description</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form action="/user/create-course/{{group_id}}" method="post">
            <div class="form-group">
              <label for="course-name" class="col-form-label">Course Name:</label>
              <input type="text" name="course-name" class="form-control" id="course-name" placeholder="Title">
            </div>
            <div class="form-group">
              <label for="number-of-topics" class="col-form-label">Number Of Topics:</label>
              <input type="number" name="number-of-topics" class="form-control" id="number-of-topics" placeholder="Topics">
            </div>
            <div class="form-group">
                <label for="url" class="col-form-label">Url:</label>
                <input type="text" name="url" class="form-control" id="url" placeholder="Link to downloadable document">
            </div>
            <div class="form-group">
              <label for="message-text" class="col-form-label">Description</label>
              <textarea name="description" class="form-control" id="message-text"></textarea>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <button type="submit" id="button-up" class="button-upload">Upload</button>
            </div>
          </form>
        </div>
      </div>
    </div>
</div>
{% endblock content%}

{% block script %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<!-- <script>
  document.getElementById("practiceForm").addEventListener("submit", function(event) {
    event.preventDefault(); // Prevent default form submission
    var mode = document.querySelector("#practiceForm select[aria-label='mode']").value;
    var topics = Array.from(document.querySelectorAll("#practiceForm select[aria-label='topics'] option:checked")).map(option => option.value);
    var hours = document.getElementById("hours").value;
    var minutes = document.getElementById("minutes").value;
    var userId = "{{ user.id }}";
    var courseId = "{{ courseId }}";
    
    // Construct the URL
    var url = `/practice/${userId}/${courseId}?mode=${mode}&topics=${topics.join(',')}&hours=${hours}&minutes=${minutes}`;
    
    // Redirect to the constructed URL
    window.location.href = url;
  });
  </script> -->
  <script>
  
  $(document).ready(function () {
    let courseId;
    console.log("here")
    $('#setpractice').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);  //Button that triggered the modal
        courseId = button.data('courseid');  //Extract group ID from data-groupid attribute
    });
    $("#practiceForm").submit(function(event) {
      event.preventDefault(); // Prevent default form submission
      var mode = $("select[aria-label='mode']").val();
      var topics = $("#topics").val() || [];
      var hours = $("#hours").val();
      var minutes = $("#minutes").val();
      var userId = "{{ user.id }}";
      
      // Construct the URL
      var url = `/quiz/setstudymode/${userId}/${courseId}?mode=${mode}&topics=${topics.join(',')}&hours=${hours}&minutes=${minutes}`;
      
      // Redirect to the constructed URL
      window.location.href = url;
    });
    $('#hoursGroup').hide();
    $('#minutesGroup').hide();

    // Show or hide the hour and minutes form group based on the selected mode
    $('#mode').change(function() {
        var selectedMode = $(this).val();
        if (selectedMode === 'practice') {
            $('#hoursGroup').hide();
            $('#minutesGroup').hide();
            $('#button-pin').text('Start Practice');
        } else if("exam") {
            $('#hoursGroup').show();
            $('#minutesGroup').show();
            $('#button-pin').text('Start Exam');
        }
    });
  })
</script>
{% endblock %}